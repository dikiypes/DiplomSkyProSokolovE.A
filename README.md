# Дипломная работа на тему "поисковик по текстам документов"

  - [Задание](#задание)
    - [Общее описание](#общее-описание)
    - [Структура БД](#структура-бд)
    - [Структура Индекса](#структура-индекса)
    - [Необходимые методы](#необходимые-методы)
    - [Технические требования](#технические-требования)
  - [О проекте](#о-проекте)
    - [Структура](#структура)
    - [Методы API](#методы-api)
  - [Как запускать?](#как-запускать)

## Задание

### Общее описание

Необходимо написать очень простой поисковик по текстам документов.
Данные хранятся в БД по желанию, поисковый индекс в эластике.

### Структура БД

- `id` - уникальный для каждого документа
- `rubrics` - массив рубрик
- `text` - текст документа
- `created_date` - дата создания документа

### Структура Индекса

- `id` - id из базы
- `text` - текст из структуры БД

### Необходимые методы

- сервис должен принимать на вход произвольный текстовый запрос, искать по тексту документа в индексе и возвращать первые 20 документов со всем полями БД, упорядоченные по дате создания
- удалять документ из БД и индекса по полю  `id`

### Требуемый стэк

- python 3.11
- по желанию - использование async
- Docker
- Django

## О проекте

### Структура

```
.
├── document_search_service
│   ├── config
│   │   ├── asgi.py
│   │   ├── __init__.py
│   │   ├── __pycache__
│   │   │   ├── __init__.cpython-311.pyc
│   │   │   ├── settings.cpython-311.pyc
│   │   │   └── urls.cpython-311.pyc
│   │   ├── settings.py
│   │   ├── urls.py
│   │   └── wsgi.py
│   ├── db.sqlite3
│   ├── docker-compose.yml
│   ├── Dockerfile
│   ├── documents
│   │   ├── admin.py
│   │   ├── apps.py
│   │   ├── documents_indexes.py
│   │   ├── __init__.py
│   │   ├── migrations
│   │   │   ├── 0001_initial.py
│   │   │   ├── 0002_post_delete_document.py
│   │   │   ├── __init__.py
│   │   │   └── __pycache__
│   │   │       ├── 0001_initial.cpython-311.pyc
│   │   │       ├── 0002_post_delete_document.cpython-311.pyc
│   │   │       └── __init__.cpython-311.pyc
│   │   ├── models.py
│   │   ├── __pycache__
│   │   │   ├── admin.cpython-311.pyc
│   │   │   ├── apps.cpython-311.pyc
│   │   │   ├── __init__.cpython-311.pyc
│   │   │   └── models.cpython-311.pyc
│   │   ├── services.py
│   │   ├── swagger.py
│   │   ├── tests.py
│   │   ├── urls.py
│   │   ├── utils.py
│   │   └── views.py
│   ├── load_data.py
│   ├── manage.py
│   ├── posts.csv
│   └── requirements.txt
├── poetry.lock
├── pyproject.toml
├── README.md
└── tests
    └── __init__.py
```

### Методы API

Продублирую документацию к API в читаемом виде:

- `documents/search/?q=`:
    - Тип запроса: GET
    - Параметр: `q` - строка, которую нужно искать
    - Ответ: массив объектов Post:
    ```
    [
        {
            "id": int,
            "text": string,
            "created_date": string,
            "rubrics": [string, string, ...]
        },
        ...
    ]
    ```
- `documents/delete/id`:
    - Тип запроса: GET
    - Параметр: `id` - id поста 
    - Ответ: строка `True` или строка с ошибкой

- `documents/load-data`:
    - Тип запроса: GET
    - Ответ: строка `True` или строка с ошибкой

## Как запускать?

Для сборки и запуска контейнера нужно запустить docker compose up --build
Сервис стартует по адресу 127.0.0.1:3055.

PS. Для первого запуска Elasticsearch скачивается его image, чтобы он скачался нужно включить vpn! Первый запрос после запуска займет немного времени из-за создания индекса.